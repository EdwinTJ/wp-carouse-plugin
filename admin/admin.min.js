jQuery(document).ready(e=>{function t(t,a,o){e(t).on("change",'input[type="radio"]',function(){const t=e(this).val();e.post(ajaxurl,{action:"pf_get_style_options_html",style_key:t,registry:o},function(t){t.success&&e(a).html(t.data)})})}let a;e(".pf-style-cards").on("change",'input[type="radio"]',function(){e(this).closest(".pf-style-cards").find(".pf-style-card").removeClass("pf-style-card-selected"),e(this).closest(".pf-style-card").addClass("pf-style-card-selected")}),e("#pf-shortcodes-table").on("click",".pf-edit-inline",function(t){t.preventDefault();const a=e(this).closest("tr");a.addClass("editing");const o=a.find(".col-autoplay").text().trim(),s=a.find(".col-autoplayDelay").text().replace(" ms","").trim();a.find(".col-autoplay").html(`<select><option value="true" ${"true"===o?"selected":""}>Enabled</option><option value="false" ${"false"===o?"selected":""}>Disabled</option></select>`),a.find(".col-autoplayDelay").html(`<input type="number" value="${s}" min="500" step="100" />`),a.find(".pf-action-edit").hide(),a.find(".pf-action-save, .pf-action-cancel").show()}),e("#pf-shortcodes-table").on("click",".pf-cancel-inline",function(t){t.preventDefault();const a=e(this).closest("tr");a.removeClass("editing");const o=a.find(".col-autoplay select").val(),s=a.find(".col-autoplayDelay input").val();a.find(".col-autoplay").text(o),a.find(".col-autoplayDelay").text(s+" ms"),a.find(".pf-action-edit").show(),a.find(".pf-action-save, .pf-action-cancel").hide()}),e("#pf-shortcodes-table").on("click",".pf-save-inline",function(t){t.preventDefault();const a=e(this).closest("tr"),o=a.data("post"),s=a.data("id"),i=a.find(".col-autoplay select").val(),n=a.find(".col-autoplayDelay input").val();e.post(ajaxurl,{action:"pf_update_carousel_config",post_id:o,edit_id:s,autoplay:i,autoplayDelay:n},function(e){e.success?(a.find(".col-autoplay").text(i),a.find(".col-autoplayDelay").text(n+" ms"),a.removeClass("editing"),a.find(".pf-action-edit").show(),a.find(".pf-action-save, .pf-action-cancel").hide()):alert("Error updating carousel.")})}),e("#pf-new-carousel-form").on("submit",function(t){t.preventDefault();const a=e(this).serializeArray(),o={action:"pf_create_carousel"};a.forEach(e=>o[e.name]=e.value),e.ajax({url:ajaxurl,method:"POST",data:o,success:function(e){if(e.success){const t=o.pf_new_id,a=e.data&&e.data.post_id?e.data.post_id:"";window.location.href=`?page=pf-carousel-settings&tab=shortcodes&created=${encodeURIComponent(t)}&post=${a}`}else alert("Error creating carousel: "+(e.data||"Unknown error"))}})}),e("#pf-shortcodes-table").on("click",".pf-copy-shortcode",function(t){t.preventDefault();const a=e(this).siblings(".pf-shortcode-hidden"),o=e(this);navigator.clipboard?navigator.clipboard.writeText(a.val()).then(function(){o.text("Copied!"),setTimeout(()=>o.text("Copy"),1500)}):(a.show().select(),a[0].setSelectionRange(0,99999),document.execCommand("copy"),a.hide(),o.text("Copied!"),setTimeout(()=>o.text("Copy"),1500))}),e("#pf-shortcodes-table").on("click",".pf-delete-carousel",function(t){t.preventDefault();const a=e(this).closest("tr").data("id");alert('Delete functionality for "'+a+'" is coming soon.')}),t("#pf-carousel-style-cards","#pf-carousel-style-options","carousel"),t("#pf-nav-style-cards","#pf-nav-style-options","nav"),e('input[name="pf_image_source"]').on("change",function(){"media"===e(this).val()?(e("#pf-media-library-section").show(),e("#pf-url-section").hide()):(e("#pf-media-library-section").hide(),e("#pf-url-section").show())}),e("#pf-selected-images").on("click",".pf-remove-image",function(){e(this).closest(".pf-image-card").remove(),0===e("#pf-selected-images .pf-image-card").length&&e("#pf-no-images-msg").show()}),e("#pf-add-images").on("click",function(t){t.preventDefault(),a||(a=wp.media({title:"Select Carousel Images",button:{text:"Add to Carousel"},multiple:!0}),a.on("select",function(){const t=a.state().get("selection"),o=e("#pf-selected-images");o.empty(),e("#pf-no-images-msg").hide(),t.map(function(e){const t=(e=e.toJSON()).sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;o.append(`<div class="pf-image-card" data-id="${e.id}"><img src="${t}" /><button type="button" class="pf-remove-image" title="Remove image">&times;</button></div>`)})})),a.open()}),e("#pf-full-config-form").on("submit",function(t){t.preventDefault();const a=new URLSearchParams(window.location.search).get("post"),o=new URLSearchParams(window.location.search).get("id"),s=e(this).find('select[name="pf_autoplay"]').val(),i=e(this).find('input[name="pf_autoplayDelay"]').val();let n=[];"media"===e('input[name="pf_image_source"]:checked').val()?e("#pf-selected-images .pf-image-card").each(function(){n.push(e(this).data("id"))}):e("#pf-image-urls").val().split("\n").forEach(e=>{e.trim()&&n.push(e.trim())});const l=e('input[name="pf_carousel_style"]:checked').val()||"default",c=e('input[name="pf_nav_style"]:checked').val()||"minimal";let p={};e("#pf-carousel-style-options input[data-key]").each(function(){p[e(this).data("key")]=e(this).val()});let d={};e("#pf-nav-style-options input[data-key]").each(function(){d[e(this).data("key")]=e(this).val()}),e.post(ajaxurl,{action:"pf_update_carousel_config",post_id:a,edit_id:o,autoplay:s,autoplayDelay:i,images:n,carousel_style:l,nav_style:c,carousel_style_options:p,nav_style_options:d},function(e){e.success?window.location.href=`?page=pf-carousel-settings&tab=shortcodes&saved=${encodeURIComponent(o)}`:alert("Error saving carousel.")})})});